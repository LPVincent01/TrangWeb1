<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Trang BÃ¡o Sá»­a Thiáº¿t Bá»‹ VÄƒn PhÃ²ng</title>
    <link rel="stylesheet" href="styles.css" />
    <!-- Firebase SDK v9 -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import {
        getFirestore,
        collection,
        addDoc,
        updateDoc,
        doc,
        onSnapshot,
        query,
        orderBy,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

      // Firebase Configuration - THAY Äá»”I CONFIG NÃ€Y
      const firebaseConfig = {
        apiKey: "AIzaSyAk5Th-iEsEU3jGOFqFxZY3JfOsFGyCbSg",
        authDomain: "trangweb1-5973d.firebaseapp.com",
        projectId: "trangweb1-5973d",
        storageBucket: "trangweb1-5973d.firebasestorage.app",
        messagingSenderId: "111780657212",
        appId: "1:111780657212:web:249fffd3a9ec9867962b39",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const reportsCollection = collection(db, "bug_reports");

      // Make Firebase available globally
      window.firebaseApp = {
        db,
        reportsCollection,
        addDoc,
        updateDoc,
        doc,
        onSnapshot,
        query,
        orderBy,
      };
    </script>
  </head>
  <body>
    <div class="container">
      <!-- Loading Screen -->
      <div id="loading" class="loading-screen">
        <div class="loading-content">
          <div class="spinner"></div>
          <p>Äang táº£i dá»¯ liá»‡u tá»« Firebase...</p>
        </div>
      </div>

      <!-- Main App -->
      <div id="app" class="app hidden">
        <!-- Header -->
        <header class="header">
          <h1>
            ğŸ”§ Trang BÃ¡o Sá»­a Thiáº¿t Bá»‹ VÄƒn PhÃ²ng
            <span class="cloud-icon">â˜ï¸</span>
          </h1>
          <p>
            Há»‡ thá»‘ng quáº£n lÃ½ bÃ¡o cÃ¡o sá»­a chá»¯a vá»›i Firebase Cloud Storage. Dá»¯
            liá»‡u Ä‘Æ°á»£c Ä‘á»“ng bá»™ real-time.
          </p>
          <div class="stats" id="stats">
            <div class="stat-item">
              <div class="stat-dot stat-new"></div>
              <span>Má»›i: <span id="stat-new">0</span></span>
            </div>
            <div class="stat-item">
              <div class="stat-dot stat-processing"></div>
              <span>Äang xá»­ lÃ½: <span id="stat-processing">0</span></span>
            </div>
            <div class="stat-item">
              <div class="stat-dot stat-done"></div>
              <span>HoÃ n thÃ nh: <span id="stat-done">0</span></span>
            </div>
          </div>
        </header>

        <!-- Add Report Form -->
        <div class="add-form">
          <h3>
            â• ThÃªm bÃ¡o cÃ¡o má»›i
            <span id="saving-indicator" class="saving-indicator hidden"
              >ğŸ’¾ Äang lÆ°u...</span
            >
          </h3>
          <div class="form-row">
            <input
              type="text"
              id="newTitle"
              placeholder="TiÃªu Ä‘á» sá»± cá»‘ (vÃ­ dá»¥: VÃ²i nÆ°á»›c rá»‰, bÃ³ng Ä‘Ã¨n há»ng...)"
              class="input-title"
            />
            <input
              type="text"
              id="newReporter"
              placeholder="NgÆ°á»i bÃ¡o (tuá»³ chá»n)"
              class="input-reporter"
            />
            <button id="addBtn" class="btn-add">ThÃªm bÃ¡o cÃ¡o</button>
          </div>
          <textarea
            id="newDesc"
            placeholder="MÃ´ táº£ chi tiáº¿t (tuá»³ chá»n)"
            rows="2"
          ></textarea>
        </div>

        <!-- Filters -->
        <div class="filters">
          <div class="search-box">
            <input
              type="text"
              id="searchInput"
              placeholder="ğŸ” TÃ¬m kiáº¿m bÃ¡o cÃ¡o..."
            />
          </div>
          <select id="statusFilter">
            <option value="Táº¥t cáº£">Táº¥t cáº£ tráº¡ng thÃ¡i</option>
            <option value="Má»›i">ğŸŸ¡ Má»›i</option>
            <option value="Äang xá»­ lÃ½">ğŸ”µ Äang xá»­ lÃ½</option>
            <option value="HoÃ n thÃ nh">ğŸŸ¢ HoÃ n thÃ nh</option>
          </select>
          <div class="result-count" id="resultCount">Hiá»ƒn thá»‹: 0/0 bÃ¡o cÃ¡o</div>
        </div>

        <!-- Reports Table -->
        <div class="table-container">
          <table id="reportsTable">
            <thead>
              <tr>
                <th width="40"></th>
                <th>TiÃªu Ä‘á»</th>
                <th class="hidden-mobile">NgÆ°á»i bÃ¡o</th>
                <th class="hidden-mobile">NgÃ y táº¡o</th>
                <th>Tráº¡ng thÃ¡i</th>
                <th class="hidden-mobile">Ghi chÃº</th>
              </tr>
            </thead>
            <tbody id="reportsBody">
              <!-- Reports will be inserted here -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Modal -->
      <div id="modal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h2 id="modalTitle"></h2>
            <span class="close">&times;</span>
          </div>
          <div class="modal-body">
            <div class="report-info" id="reportInfo"></div>
            <div class="notes-section">
              <h4>ğŸ“ Lá»‹ch sá»­ ghi chÃº (<span id="notesCount">0</span>)</h4>
              <div class="notes-list" id="notesList"></div>
            </div>
            <div class="add-note-section">
              <label>ThÃªm ghi chÃº má»›i</label>
              <textarea
                id="newNote"
                placeholder="Nháº­p ná»™i dung cáº­p nháº­t, tiáº¿n Ä‘á»™ xá»­ lÃ½..."
                rows="3"
              ></textarea>
              <div class="modal-actions">
                <button id="saveNoteBtn" class="btn-primary">
                  ğŸ’¾ LÆ°u ghi chÃº
                </button>
                <button id="setProcessingBtn" class="btn-secondary">
                  ğŸ”„ Äang xá»­ lÃ½
                </button>
                <button id="markDoneBtn" class="btn-success">
                  âœ… HoÃ n thÃ nh
                </button>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <p>
              â˜ï¸ Dá»¯ liá»‡u Ä‘Æ°á»£c lÆ°u trá»¯ trÃªn Firebase Cloud vÃ  Ä‘á»“ng bá»™ real-time
            </p>
          </div>
        </div>
      </div>

      <!-- Error Message -->
      <div id="errorMessage" class="error-message hidden">
        <div class="error-content">
          <h3>âŒ Lá»—i káº¿t ná»‘i Firebase</h3>
          <p>Vui lÃ²ng kiá»ƒm tra:</p>
          <ul>
            <li>Káº¿t ná»‘i internet</li>
            <li>Cáº¥u hÃ¬nh Firebase trong code</li>
            <li>Firestore Security Rules</li>
          </ul>
          <button onclick="location.reload()" class="btn-retry">
            ğŸ”„ Thá»­ láº¡i
          </button>
        </div>
      </div>
    </div>

    <script src="script.js"></script>
  </body>
</html>
